<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title th:text="'Тикет: ' + ${ticket.title}"></title>
    <link rel="stylesheet" th:href="@{/css/user-ticket-details.css}">
</head>
<body>

<div class="container">

    <!-- ****************************
         Блок заголовка (режим просмотра)
         **************************** -->
    <div th:if="${editMode == false}" class="header" >
        <h1 th:text="${ticket.title}"></h1>
    </div>

    <!-- ****************************
         ФОРМА РЕДАКТИРОВАНИЯ — оборачивает и title, и description
         **************************** -->
    <form th:if="${editMode}"
          th:action="@{/tickets/my/{id}/update(id=${ticket.id})}"
          method="POST">

        <div class="header">
            <label>
                <input th:value="${ticket.title}"
                       type="text"
                       name="newTitle"
                       class="edit-input">
            </label>
        </div>

        <div class="ticket-full">

            <!-- Описание -->
            <label>
                <textarea th:text="${ticket.description}"
                          name="newDescription"
                          class="edit-textarea"
                          rows="5"></textarea>
            </label>

            <!-- Кнопки сохранения -->
            <div class="ticket-actions">
                <button type="submit" class="btn status-btn">Сохранить</button>

                <a th:href="@{/tickets/my/{id}(id=${ticket.id})}"
                   class="btn delete-btn" style="background:#777;">
                    Отмена
                </a>
            </div>
        </div>
    </form>

    <!-- ****************************
         Режим просмотра — полное отображение тикета
         **************************** -->
    <div th:if="${editMode == false}" class="ticket-full">

        <div th:text="${ticket.description}" class="ticket-desc-full" ></div>

        <!-- Метаданные -->
        <div class="ticket-meta-full">
            <p><strong>Статус: </strong><span th:text="${ticket.status}"></span></p>
            <p><strong>Создан: </strong>
                <span th:text="${#temporals.format(ticket.createdAt, 'dd.MM.yyyy HH:mm')}"></span>
            </p>
            <p th:if="${ticket.updatedAt > ticket.createdAt}" ><strong>Изменён: </strong>
                <span th:text="${#temporals.format(ticket.updatedAt, 'dd.MM.yyyy HH:mm')}"></span>
            </p>
            <p th:if="${ticket.status.name == 'DONE'}"><strong>Выполнен: </strong>
                <span th:text="${#temporals.format(ticket.updatedAt, 'dd.MM.yyyy HH:mm')}"></span>
            </p>
            <p><strong>Автор: </strong>
                <span th:text="${ticket.createdBy.username}"></span>
            </p>

            <p><strong>Исполнитель: </strong>
                <span th:if="${ticket.assignedTo != null}"
                      th:text="${ticket.assignedTo.username}"></span>
                <span th:if="${ticket.assignedTo == null}">не назначен</span>
            </p>
        </div>

        <!-- Действия -->
        <div class="ticket-actions">
            <!-- Редактировать -->
            <a th:href="@{/tickets/my/{id}(id=${ticket.id}, edit=${true})}"
               class="btn edit-btn">Редактировать</a>
        </div>
    </div>

    <a class="create-btn" th:href="@{/tickets/my(filter=${'all'})}">← Назад к списку</a>
</div>

</body>
</html>
